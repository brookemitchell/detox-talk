import { Head, Image, Appear } from 'mdx-deck'
import { CodeSurfer } from "mdx-deck-code-surfer"

export { comic as theme } from 'mdx-deck/themes'

<Head>
  <title>Detox your apps</title>
</Head>

# Hello ğŸŒŠ ğŸ‘‹

```notes
- Kia Ora kou tou - Ko Brooke Mitchell ahau.
- This is me waving hello
- Apologies to those that aren't big emoji users.
- Tbh I don't usually, but they are one of the fastest ways to help a few slides look slightly less boring.
```
---

# Bad days at work ğŸ™

<Appear> <h1> App Release Day ğŸŒŠğŸŒ© </h1> </Appear>

<!-- Image of apple store submission -->

```notes
- I want to tell you what used to be the most trying days at work (Press Down) - App submission day
- Once I used to keep a long boring checklist of things to do before an app store submission.
- Test login, send a reply, create a notification, open a dynamic link.
- It was time consuming and could easily take a day or two.
- You've also had the experience of nervousness as to whether you new 'feature' is really a regression.
- And have felt the anxiety of an App Store release that passed review, but broke core some core piece of functionality.
- I have done all those things.
- This talk is about showing you the steps you can take to relax a little,
- I'll tell you the most important thing about making sure your app survives constant change
- Right now I'll often update an app multiple times a day without much drama.
- One part of getting that confidence in the app is
```
---

# Detox your apps â˜£

<Appear>
	<h1> Explore your code ğŸ—º </h1>
	<h2> From your users point of view ğŸ‘€ </h2>
</Appear>

```notes
- There is a tools to automate those final crucial checks in you react native applications
- Talk is called `Detox your apps` - That isn't the greatest name for a talk.
- Why? 1st Because no one should consider their app toxic.
- So anyway, I dont love the title of this talk, I think it should be
- It's time to explore the critical path of your app from a users point of view
- 2nd no one tool will save you from the messiness of writing a real app. Trust me.
- We'll talk about some of my opinions on testing, and the best ways to use detox.
- This is leading into a discussin of how to completely automate much more of your app delivery process.
- But thats another talk we can do another time.
- Which isn't the greatest name, so we'll just stick with detox your apps
```
---

# About Me ğŸ’

Brooke Mitchell (he/him) - <brooke@asknice.ly>

  <Appear>
		<img src='https://s3-us-west-2.amazonaws.com/rn-auckland-detox-talk/images/an_logo.png' />
  </Appear>

```notes
- So about me:
- I've been writing react native for about 2 years.
- If you want to talk more about what I do, or talk about react native - drop me a line
- I work for a company called AskNicely. We make customer experience software.
```
---
<Image src="https://s3-us-west-2.amazonaws.com/rn-auckland-detox-talk/images/an_logo_phone.png"
	style={{position: 'relative', top: '5px' }} />

```notes
- Here is an excellent piece of branding that looks nothing like the way way really work.
	- Don't worry we dont really sit that close together
- I develop a mobile app that lets account manager check their surveys, get alerts and respond from mobile
- I'm abot  is a quick demo our app in one of the detox test runs (show demo!)
- Unfortunately its probably best that I show a video of this,
  	- Incase I accedentailly tab into a part of the code base labelled 'super secret new feature'
- We'll try running a live demo of detox later in the talk.
	- Which for anyone that worked with previous end to end testing tools is pretty daring
		- A lot of times visual testing tools will fail in hilarious ways, getting a computer to act like a user is hard
- So what's going on here? That brings us to this talk
```
---
# Automate regression testing ğŸ†ğŸ¹ğŸ
<Appear>
	<h3> But dont forget to write unit tests too...</h3>
	<h1> Thanks to eyeliner music - buy here: <a href="https://disasteradio.bandcamp.com/album/buy-now">https://disasteradio.bandcamp.com</a></h1>
</Appear>

```notes
- Right at the outset, this is a very seductive form of testing, it looks cool
- But don't go overboard, think of it as the cherry on top
- I even added cool music to show how great it is, thanks to eyeliner, you can buy their music here: https://disasteradio.bandcamp.com/ .
- Sadly the musics isn't included in the app
- Perfect for rewatching all your favourite tech demos
- Ok so what is this amazing tool automating all our boring manual tests?
```
---
# Detox ! ğŸ¾

<https://github.com/wix/Detox>
<div>
	<h3> Gray box end-to-end testing and automation library for mobile apps </h3>
	<ul>
	<Appear>
		<li> automation library â‰ </li>
		<li> end-to-end testing â‰â‰â‰â‰â‰â‰</li>
		<li> Gray box â‰â‰â‰â‰â‰â‰â‰â‰â‰â‰â‰ </li>
	</Appear>
	</ul>
</div>


```notes
- So detox is an (read slide)
- What does all that mean (press down)
- We'll go over all three of those, cool next slide
```

---
# Automation ğŸ¤–
  <Appear>
	<h2>See user workflow before submission</h2>
	<h2>Create Screenshots and videos ğŸ“¼</h2>
	<h2>Check pull requests</h2>
  </Appear>

```notes
- Firstly a tool for automation
- You can watch along with what youd normally do manually
- Take video and screenshot for you app store submissions
- Then run in headless mode on something like a jenkins or travis server, using using a service like bitrise
- Check pull requests, thats the other talk I was refereencing

```

---
# Testing âœğŸ“±ğŸ’

  <Appear>
	<h2> Unit </h2>
	<h2> Integration </h2>
	<h2> End-to-End </h2>
  </Appear>

```notes
- Seond part, end to end testing. Commonly people break things down into these three fundamental catagories of tests
	- There are many more kinds (like performance, accessability, legacy)
- We are interested in end to end testing here, where you build the final product and tet it like a user would
- I think Testing is an art, it might sound lame but I really enjoy testing
- After a while it can become fun to think and strategize your approach before committing code
- No Test shame - any test is nearly always better than no test
- So when writing tests, there is a common recommendation about how many tests of each kind you should have.
```
---
# Pyramid of boredom ğŸ˜ª

  ![](https://s3-us-west-2.amazonaws.com/rn-auckland-detox-talk/images/testing_pyramid.png)

```notes
- These three approaches make up the Pyramid of boredom
- I think - The pyramid is a bit of a lie, but kind of like a useful fallacy, you can write slow unit tests and fast integration tests, and blend elements together
- This recommendation emerged because there was a common mistake to see companies overly focused on manual testing and end to end testing
- So back in - (2012?) google put out a now famous blog post that popularized the now common idea optimum ratio of unit/Integration/e2e is 70%/20%/10%
- next slide
```
---
# Pyramid of boredom ğŸ˜…

<Appear>
	<h3>  Just joking - this is how I work </h3>
</Appear>

```notes
- I think following the pyramid is still really good advice
- Dont have time to really go into it here, but a tool like detox is never going to be fast,
	- In he time I run these (sped up) demos, could probably get through 1000 or more unit tests
	- its a good idea to avoid getting stuck doing too much in e2e tests
	- but when it is time to write e2e tests, I want to recommend detox
	- why - it's closer to an integration test while still having all the visual flashy bits.
	- ill explain more shortly
```
---
# Other views ğŸ¤”
![](https://s3-us-west-2.amazonaws.com/rn-auckland-detox-talk/images/write_tests.png)

```notes
- Very quickly point out some other approaches
- I think a lot of this is happending because no teveryone loves test driven development
- And in react if you are careful you can write some good integration tests
- Now lets go over what all these flavours of test look like
```
---
# Other views ğŸ¤”
<div>
	<Image src="./images/testing_trophy.png" width="525px" height="525px" />
</div>
<a href="https://blog.kentcdodds.com/write-tests-not-too-many-mostly-integration-5e8c7fff591c">Kent C. Dodds</a>

---

<CodeSurfer title="Unit" code={require("!raw-loader!./code_examples/unit_test.js")} />

```notes
- Look at code from functions point of view
- Input -> Output
```
---

<CodeSurfer title="Integration" code={require("!raw-loader!./code_examples/integration_test.js")} />

```notes
- Look at code from developers point of view, using a component
```

---

<CodeSurfer title="END TO END! ğŸ†ğŸ‡ğŸ†" code={require("!raw-loader!./code_examples/e2e_test.js")} />

```notes
- Look at code from users point of view
- It's a bit like you are stadning behind a person at the computer telling them what to click on
- How did we know about these special ids'
- Its because we are.... gray box testing
```
---

# Grey box ğŸ˜

- Grey box is where the tester is allowed to know a little about the internal structure

```jsx
	element.id('internal-test-id');
```
	<Appear>
	<h1> How did we know a network request has finished before clicking? </h1>
	<h1> What about timers and pixels? </h1>
	</Appear>

```notes
```
---
# Grey box  - Earl Grey ğŸµ

- Detox depends on Earl Grey <https://github.com/google/EarlGrey>
- Earl grey waits until the UI is in a steady state
- No â²â°â² needed!

```notes
- They secret sauce in detox is Earl Gray (from Google)
- Could call it a library built around grey box testing
- it knows a lot about the visual state of your app
- That's usually the perfect time to check visual things
```
---
# Detox â˜£ <-> Earl Grey ğŸµ communication cycle

![](https://github.com/wix/Detox/blob/master/docs/img/action-sequence.mmd.png?raw=true)

```notes
- Oddly reminiscent of the javascript <> native bridge in react-native
```

---

<CodeSurfer title="END TO END!" code={require("!raw-loader!./code_examples/e2e_test.js")} />

```notes
	- Look, no timers!
	- It's not perfect
```
---
# Now we know Detox ğŸ“

- Gray box end-to-end testing (and automation) for mobile apps

```notes
- Some final reflections: - Detox is no silver bullet . No silver bullet
- There is no escaping the nightmare
- It's a marathon not a sprint
- Automated UI testing has a huge number of trade offs, and I wouldnt always recommend it
- Too many of these tests are just too slow, I can easily run about 1000 unit tests in the same time
```
---
# Now we know Detox ğŸ“


---

# Mocking ğŸ‘»
![](https://s3-us-west-2.amazonaws.com/rn-auckland-detox-talk/images/api_mock.png)

<div>
	<ul>
		<Appear>
			<li> Detox has its own mocking feature,</li>
			<li> You can mock out a file by placing a .e2e.js file next to it</li>
		</Appear>
	</ul>
</div>

```notes
- One more things
- Detox has its own mocking feature, which will pick up mocks of .e2e.js calls
- You can mock api calls to always return expected responses
- Start to blur the lines between integration and e2e tests --- if we want to.
```

---
# Demo Time ğŸ•¶

---
# Learn how Detox works ğŸ“”

- [How Detox Works: Official Docs](https://github.com/wix/detox/blob/master/docs/Introduction.HowDetoxWorks.md)

---
# Other Talks to watch ğŸ¥
## Both by Rotem Mizrachi-Meidan @ Wix
- [Detox: A year in. Building it, Testing with it](https://www.youtube.com/watch?v=aMheT1qL5Lk)
- [Graybox E2E Tests Library for React Native](https://www.youtube.com/watch?v=GgFFeI70PWw)


---

## Github Repos ğŸ’»

- Talk - <https://github.com/brookemitchell/detox-talk>
- Example App - <https://github.com/brookemitchell/example-detox-app>
