import { Head, Image, Appear } from 'mdx-deck'
import { CodeSurfer } from "mdx-deck-code-surfer"

export { comic as theme } from 'mdx-deck/themes'

<Head>
  <title>Detox your apps</title>
</Head>

# Hello 🌊 👋

```notes
- Kia Ora kou tou - Ko Brooke Mitchell ahau.
- This is me waving hello
- Apologies to those that aren't big emoji users.
- Tbh I don't usually, but they are one of the fastest ways to help a few slides look slightly less boring.
```
---

# Days of drama 🙁

<Appear> <li> App Release Day 🌊🌩 </li> </Appear>

<!-- Image of apple store submission -->

```notes
- I want to tell you what used to be the most trying days at work (Press Down) - App submission day
- Once I used to keep a long boring checklist of things to do before an app store submission.
- Test login, send a reply, create a notification, open a dynamic link.
- It was time consuming and could easily take a day or two.
- You've also had the experience of nervousness as to whether you new 'feature' is really a regression.
- And have felt the anxiety of an App Store release that passed review, but broke core some core piece of functionality.
- I have done all those things.
- This talk is about showing you the steps you can take to relax a little,
- I'll tell you the most important thing about making sure your app survives constant change
- Right now I'll often update an app multiple times a day without much drama.
- One of ways to do that is:
```
---

# Detox your apps ☣

<Appear>
	<h1> Explore your apps 🗺  </h1>
</Appear>

```notes
- This is a talk about using a tools name detox to end to end test your react native applications
- Talk is called `Detox your apps` - That isn't the greatest name for a talk.
- Why? 1st Because no one should consider their app toxic.
- 2nd no one tool will save you from the messiness of writing a real app. Trust me.
- I will tell you some of the best ways to use this tool to save your app from missing functionality
- 2nd testing tools like this will help you to automating much more of your app delivery process. But thats another talk.
- More appropriate talk title is - It's time to deeply explore the critical path of your app from a users point of view
- Which isn't the greatest name, so we'll just stick with detox your apps
```
---
# Automate your quality assurance 🏆🍹🏝
<Appear>
	<h1> But dont forget to write unit tests too...</h1>
</Appear>
---

# About Me 💁

Brooke Mitchell (he/him) - <brooke@asknice.ly>

  <Appear>
		<img src='https://s3-us-west-2.amazonaws.com/rn-auckland-detox-talk/images/an_logo.png' />
  </Appear>

```notes
- So about me:
- I've been writing react native for about 2 years.
- If you want to talk more about what I do, or talk about react native - drop me a line
- I work for a company called AskNicely. We make customer experience software.
```
---
<Image src="https://s3-us-west-2.amazonaws.com/rn-auckland-detox-talk/images/an_logo_phone.png"
	style={{position: 'relative', top: '5px' }} />

```notes
- Here is an excellent piece of branding that looks nothing like the way way really work.
	- Don't worry we dont really sit that close together
- I've been writing react native for about 2 years.
- We develop a mobile app that lets account manager check their surveys, get alerts and respond from mobile
- Here is a quick demo of one of the detox test runs
- Unfortunately its probably best that I show an approved video of this,
  	- Incase I accedentailly tab into a part of the code base labelled 'super secret new feature'
- We'll try running a live demo of detox later in the talk.
	- Which for anyone that worked with previous end to end testing tools is pretty daring
- Here is a sneek peek of one of our end to end test suites running -> show ask nicely demo video
- So what's going on here? That brings us to this talk
```
---
# Detox ! 🍾

<div>
	<h3> Gray box end-to-end testing and automation library for mobile apps </h3>
	<ul>
	<Appear>
		<li> automation library ⁉ </li>
		<li> end-to-end testing ⁉⁉⁉⁉⁉⁉</li>
		<li> Gray box ⁉⁉⁉⁉⁉⁉⁉⁉⁉⁉⁉ </li>
	</Appear>
	</ul>
</div>


```notes
- Starting at end and rewinding
- automation library, automate doing things to out app
- end to end ... ok next slide
```

---
# Automation 🤖
  <Appear>
	<li>Automate the brutally important checks you make before submitting</li>
	<li>Only accept pull requests that pass</li>
	<li>Submit a new version whenever they all pass</li>
  </Appear>

```notes
- You can watch along
- Then run in headless mode on something like a jenkins or travis server, using using a service like bitrise
- That is another talk
```

---
# Testing ✍📱💁

  <Appear>
	<h2> Unit </h2>
	<h2> Integration </h2>
	<h2> End-to-End </h2>
  </Appear>

```notes
		- Testing is an art
		- No Test shame - any test is nearly always better than no test
		- I think - The pyramid is a bit of a lie, but kind of like a useful fallacy
```
---
# Pyramid of boredom 😪

  ![](https://s3-us-west-2.amazonaws.com/rn-auckland-detox-talk/images/testing_pyramid.png)

```notes
		- Pyramid of boredom
		- Part of the late popularity of this idea. is back in 2012 google put up a blog post that the optimum ratio of unit/Integration/e2e is 70%/20%/10%
```
---
# Pyramid of boredom 😅

<Appear>
	<h3>  Just joking - this is how I work </h3>
</Appear>

```notes
		- Dont have time to really go into it here, but a tool like detox is never going to be fast,
			- There is some disagreement, but it is a good idea to avoid getting stuck doing too much in e2e tests
			- it can be a lot less painful to use than other e2e testing.
			- Anyone thats tried some popular solutions for web testing knows how painful it can be
```
---
# Other views 🤔
![](https://s3-us-west-2.amazonaws.com/rn-auckland-detox-talk/images/write_tests.png)

---
# Other views 🤔
<div>
	<Image src="./images/testing_trophy.png" width="525px" height="525px" />
</div>
<a href="https://blog.kentcdodds.com/write-tests-not-too-many-mostly-integration-5e8c7fff591c">Kent C. Dodds</a>

---

<CodeSurfer title="Unit" code={require("!raw-loader!./code_examples/unit_test.js")} />

```notes
- Look at code from functions point of view
- Input -> Output
```
---

<CodeSurfer title="Integration" code={require("!raw-loader!./code_examples/integration_test.js")} />

```notes
- Look at code from developers point of view
```

---

<CodeSurfer title="END TO END! 🎆🎇🎆" code={require("!raw-loader!./code_examples/e2e_test.js")} />

```notes
- Look at code from users point of view
- How did we know about these special ids'
- Its because we are.... gray box testing
```
---

# Grey box 😁

- Grey box is where the tester is allowed to know a little about the internal structure

```jsx
	element.id('internal-test-id');
```

```notes
- How did we know about these special ids'
- Its because we are.... gray box testing
```
---
# Grey box  - Earl Grey 🍵

- Detox depends on Earl Grey <https://github.com/google/EarlGrey>
<Appear>
<li> Earl grey knows when the UI is in a steady state. </li>
<li> No ⏲ needed! </li>
</Appear>

```notes
- They secret sauce in detox is Earl Gray (from Google)
- Sorry about the green tea emoji
- Could call it a very gray focu
- That's usually the perfect time to check visual things
```

---

<CodeSurfer title="END TO END!" code={require("!raw-loader!./code_examples/e2e_test.js")} />

```notes
	- Look, no timers!
	- It's not perfect
```
---
# Now we know Detox 🎓

- Gray box end-to-end testing (and automation) for mobile apps

---
# Now we know Detox 🎓

- Some final reflections:
<div>
	<ul>
		<Appear>
			<li> Is Detox e2e or integration? 🤔</li>
			<li> Detox has its own mocking feature,</li>
			<li> You can mock out a file by placing a .e2e.js file next to it</li>
		</Appear>
	</ul>
</div>

```notes
- Detox event has its own mocking feature, which will pick up mocks of .e2e.js calls
- You can mock api calls to always return expected responses
- Start to blur the lines between integration and e2e tests --- if we want to.
```
---

# Mocking 👻
![](https://s3-us-west-2.amazonaws.com/rn-auckland-detox-talk/images/api_mock.png)


---
# Demo Time 🕶


---
# Other Talks to watch 🎥
## Both by Rotem Mizrachi-Meidan @ Wix
- [ Detox: A year in. Building it, Testing with it](https://www.youtube.com/watch?v=aMheT1qL5Lk)
- [Graybox E2E Tests Library for React Native](https://www.youtube.com/watch?v=GgFFeI70PWw)


---

## Github Repos 💻

- Talk - <https://github.com/brookemitchell/detox-talk>
- Example App - <https://github.com/brookemitchell/example-detox-app>
